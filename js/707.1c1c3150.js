"use strict";(self["webpackChunkvue_event"]=self["webpackChunkvue_event"]||[]).push([[707],{88:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("文章列表")]),e("el-button",{staticClass:"btn-pub",staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:t.showPubDialogFn}},[t._v("发布文章 ")])],1),e("div",{staticClass:"search-box"},[e("el-form",{attrs:{inline:!0,model:t.pubForm}},[e("el-form-item",{attrs:{label:"文章分类"}},[e("el-select",{attrs:{placeholder:"请选择分类",size:"small"},model:{value:t.q.cate_id,callback:function(e){t.$set(t.q,"cate_id",e)},expression:"q.cate_id"}},t._l(t.cateList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.cate_name,value:t.id}})})),1)],1),e("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"发布状态"}},[e("el-select",{attrs:{placeholder:"请选择状态",size:"small"},model:{value:t.q.state,callback:function(e){t.$set(t.q,"state",e)},expression:"q.state"}},[e("el-option",{attrs:{label:"已发布",value:"已发布"}}),e("el-option",{attrs:{label:"草稿",value:"草稿"}})],1)],1),e("el-form-item",[e("el-button",{attrs:{type:"primary",size:"small"},on:{click:t.choseFn}},[t._v("筛选")]),e("el-button",{attrs:{type:"info",size:"small"},on:{click:t.resetFn}},[t._v("重置")])],1)],1)],1),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.artList,border:"",stripe:""}},[e("el-table-column",{attrs:{label:"文章标题",prop:"title"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-link",{attrs:{type:"primary"},on:{click:function(e){return t.showDetailFn(a.row.id)}}},[t._v(t._s(a.row.title))])]}}])}),e("el-table-column",{attrs:{label:"分类",prop:"cate_name"}}),e("el-table-column",{attrs:{label:"报表时间",prop:"pub_date"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(t.$formatDate(a.row.pub_date)))])]}}])}),e("el-table-column",{attrs:{label:"状态",prop:"state"}}),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function({row:a}){return[e("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(e){return t.removeFn(a.id)}}},[t._v("删除")])]}}])})],1),e("el-dialog",{attrs:{title:"提示",visible:t.pubDialogVisible,fullscreen:"","before-close":t.handleClose},on:{"update:visible":function(e){t.pubDialogVisible=e},close:t.dialogCloseFn}},[e("el-form",{ref:"pubRef",attrs:{inline:!0,model:t.pubForm,rules:t.pubFormRules}},[e("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[e("el-input",{attrs:{placeholder:"请输入标题"},model:{value:t.pubForm.title,callback:function(e){t.$set(t.pubForm,"title",e)},expression:"pubForm.title"}})],1),e("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"文章分类",prop:"cate_id"}},[e("el-select",{attrs:{placeholder:"请选择状态",size:"small"},model:{value:t.pubForm.cate_id,callback:function(e){t.$set(t.pubForm,"cate_id",e)},expression:"pubForm.cate_id"}},t._l(t.cateList,(function(t){return e("el-option",{key:t.id,attrs:{label:t.cate_name,value:t.id}})})),1)],1),e("el-form-item",{attrs:{label:"文章内容",prop:"content"}},[e("quill-editor",{on:{blur:t.contentChangeFn},model:{value:t.pubForm.content,callback:function(e){t.$set(t.pubForm,"content",e)},expression:"pubForm.content"}})],1),e("el-form-item",{attrs:{label:"文章封面",prop:"cover_img"}},[e("img",{ref:"imgRef",staticClass:"cover-img",attrs:{src:a(9389),alt:""}}),e("br"),e("input",{ref:"iptFileRef",staticStyle:{display:"none"},attrs:{type:"file",accept:"image/*"},on:{change:t.changeCoverFn}}),e("el-button",{attrs:{type:"text"},on:{click:t.chooseImgFn}},[t._v("选择图片")])],1),e("el-form-item",{staticStyle:{display:"block"}},[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.pubArticleFn("已发布")}}},[t._v("发布")]),e("el-button",{attrs:{type:"info"},on:{click:function(e){return t.pubArticleFn("草稿")}}},[t._v("存为草稿")])],1)],1)],1),e("el-pagination",{attrs:{"current-page":t.q.pagenum,"page-sizes":[2,3,5,10],"page-size":t.q.pagesize,layout:"sizes, prev, pager, next, jumper, total",total:t.total},on:{"size-change":t.handleSizeChangeFn,"current-change":t.handleCurrentChangeFn,"update:currentPage":function(e){return t.$set(t.q,"pagenum",e)},"update:current-page":function(e){return t.$set(t.q,"pagenum",e)},"update:pageSize":function(e){return t.$set(t.q,"pagesize",e)},"update:page-size":function(e){return t.$set(t.q,"pagesize",e)}}}),e("el-dialog",{attrs:{visible:t.detailvisible,width:"80%"},on:{"update:visible":function(e){t.detailvisible=e}}},[e("h1",{staticClass:"title"},[t._v(t._s(t.artDetail.title))]),e("div",{staticClass:"info"},[e("span",[t._v("作者:"+t._s(t.artDetail.nickname||t.artDetail.username))]),e("span",[t._v("发布时间:"+t._s(t.$formatDate(t.artDetail.pub_date)))]),e("span",[t._v("所属分类:"+t._s(t.artDetail.cate_name))]),e("span",[t._v("状态:"+t._s(t.artDetail.state))])]),e("el-divider"),t.artDetail.cover_img?e("img",{attrs:{src:t.baseURLR+t.artDetail.cover_img,alt:""}}):t._e(),e("div",{staticClass:"detail-box",domProps:{innerHTML:t._s(t.artDetail.content)}})],1)],1)],1)},s=[],r=a(7877),l=a.p+"img/cover.54bfb07c.jpg",n=a(6361),o={name:"ArtList",data(){return{baseURLR:n.v,q:{pagenum:1,pagesize:2,cate_id:"",state:""},pubForm:{cate_id:"",state:"",title:"",content:"",cover_img:""},pubDialogVisible:!1,pubFormRules:{title:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:30,message:"文章标题的长度为1-30个字符",trigger:"blur"}],cate_id:[{required:!0,message:"请选择文章id",trigger:"change"}],content:[{required:!0,message:"请选择文章内容",trigger:"blur"}],state:[{required:!0,message:"请选择文章状态",trigger:"blur"}],cover_img:[{required:!0,message:"请选择文章封面",trigger:"blur"}]},cateList:[],artList:[],total:0,detailvisible:!1,artDetail:{}}},methods:{async initCateList(){const{data:t}=await(0,r.I2)();0===t.code&&(this.cateList=t.data)},async getArtListFN(){const{data:t}=await(0,r.r4)(this.q);this.artList=t.data,this.total=t.total},showPubDialogFn(){this.pubDialogVisible=!0},async handleClose(t){const e=await this.$confirm("此操作将导致文章信息丢失,是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).catch((t=>t));"cancel"!==e&&t()},chooseImgFn(){this.$refs.iptFileRef.click()},changeCoverFn(t){const e=t.target.files;if(0===e.length)this.pubForm.cover_img=null,this.$refs.imgRef.setAttribute("src",l);else{this.pubForm.cover_img=e[0];const t=URL.createObjectURL(e[0]);this.$refs.imgRef.setAttribute("src",t)}this.$refs.pubRef.validateField("cover_img")},pubArticleFn(t){this.pubForm.state=t,this.$refs.pubRef.validate((async t=>{if(!t)return!1;{const t=new FormData;t.append("title",this.pubForm.title),t.append("cate_id",this.pubForm.cate_id),t.append("content",this.pubForm.content),t.append("cover_img",this.pubForm.cover_img),t.append("state",this.pubForm.state);const{data:e}=await(0,r.Eg)(t);if(0!==e.code)return this.$message.error(e.message);this.$message.success(e.message),this.$refs.pubRef.resetFields(),this.$refs.imgRef.setAttribute("src",l),this.getArtListFN(),this.pubDialogVisible=!1}}))},contentChangeFn(){this.$refs.pubRef.validateField("content")},dialogCloseFn(){this.$refs.iptFileRef.resetFields()},handleSizeChangeFn(t){this.q.pagesize=t,this.q.pagenum=1,this.getArtListFN()},handleCurrentChangeFn(t){this.q.pagenum=t,this.getArtListFN()},choseFn(){this.q.pagenum=1,this.q.pagesize=2,this.getArtListFN()},resetFn(){this.q.pagenum=1,this.q.pagesize=2,this.q.cate_id="",this.q.state="",this.getArtListFN()},async showDetailFn(t){this.detailvisible=!0;const{data:e}=await(0,r.$D)(t);this.artDetail=e.data},async removeFn(t){const{data:e}=await(0,r.VT)(t);if(0!==e.code)return this.$message.error(e.message);this.$message.success(e.message),1===this.artList.length&&this.q.pagenum>1&&this.q.pagenum--,this.getArtListFN()}},created(){this.initCateList(),this.getArtListFN()}},c=o,u=a(1001),p=(0,u.Z)(c,i,s,!1,null,"09602741",null),m=p.exports},9389:function(t,e,a){t.exports=a.p+"img/avatar.b216c21d.jpg"}}]);
//# sourceMappingURL=707.1c1c3150.js.map